FKART.ui.Carousel=function(p){var y={columns:5,rows:1,columnsperslide:5,buttonsonside:false,allowdeletion:false,removeonerror:true,buttonOverlap:false,cssClass:"",bottomgap:0,vertical:false,alwaysshowbuttons:false};var K=$.extend({},y,p);var e=this;var h=$(p.content);var z,A,n,r,f,C,j,B,u;var L=false,i=true,k=true;var m=$(".ccarousel-item:visible",h);var E=false;var I=0;var F=K.columns;var o=function(){z=$($dc("fk-ui-ccarousel-container "+K.cssClass,"div"));A=$($dc("ccarousel-clip","div"));n=$($dc("ccarousel-wrapper","div"));f=$($dc("ccarousel-prev","a"));C=$($dc("ccarousel-next","a"));u=$($dc("arrow","div"));if(m.length==0){if(K.removeonerror==true){$(e).trigger("error")}else{return}}var M=h.parent();h.appendTo(n);n.appendTo(A);z.prependTo(M);$(".ccarousel.nojs").removeClass("nojs");if(m.length<=K.columns&&!K.alwaysshowbuttons){k=false}if(K.vertical){z.addClass("overlapped");f.addClass("onTop").appendTo(z);A.appendTo(z);C.addClass("onBottom").appendTo(z);A.css({height:z.height()})}else{if(!K.buttonsonside){r=$($dc("ccarousel-buttons","div"));f.appendTo(r);C.appendTo(r);A.appendTo(z);if(k){r.appendTo(z)}}else{f.addClass("onside").appendTo(z);A.appendTo(z);C.addClass("onside").appendTo(z);A.css({width:z.width(),"float":"left"});if(k){if(K.buttonOverlap){A.css({width:z.width()});C.addClass("overlapped");f.addClass("overlapped");z.addClass("overlapped")}else{A.css({width:z.width()-f.width()-C.width()})}}}}g();E=true};var t=function(){if(K.vertical){B=Math.floor((A.height()-(K.bottomgap*(K.columns-1)))/K.columns);m.css({height:B,"margin-bottom":K.bottomgap});n.css({height:m.length*B+(K.bottomgap*(K.columns-1))})}else{j=Math.floor(A.width()/K.columns);m.css({width:j});if(K.pagination){m.find(".carousel-item").css({width:j/K.rows})}n.css({width:m.length*j})}};var l=function(){t();C.bind("click",D);f.bind("click",s)};var D=function(){I+=K.columnsperslide;if(I>=m.length-K.columns){I=m.length-K.columns}if(I<=0){I=0}c(I);$(e).trigger("nextSlide",[m.slice(F,F+K.columnsperslide)]);F+=K.columnsperslide};var s=function(){$(e).trigger("prevSlide");I-=K.columnsperslide;if(I<=0){I=0}c(I);$(e).trigger("afterPrevSlide");F-=K.columnsperslide;$(e).trigger("lazyPrevSlide",[m.slice(F-K.columnsperslide,F)])};var c=function(M){if(K.vertical){n.css({top:-(M*(B+K.bottomgap))})}else{n.css({left:-M*j})}g()};var H=function(M){if(typeof M==="number"&&M>=0&&M<=m.length-K.columns){I=M;c(M);F=I+K.columns}};var g=function(){k=true;if(m.length<=K.columns&&!K.alwaysshowbuttons){k=false}L=(I>0);i=(I+K.columns<m.length);if(k){f.show();C.show();if(L){f.removeClass("disabled")}else{f.addClass("disabled")}if(i){C.removeClass("disabled")}else{C.addClass("disabled")}}else{f.hide();C.hide()}};var q=function(){m=$(".ccarousel-item:visible",h);I=0;c(I)};var b=function(){if(E){return}m=$(".ccarousel-item:visible",h);G();I=0;c(I)};var J=function(){$.unbind();z.remove()};var v=function(){return z.height()};var G=function(){o();l()};var x=function(){var M=[];for(var N=0;N<K.columns;N++){M.push(I+N)}return M};var w=function(){return m};var a=function(){return parseInt(I/K.columnsperslide)};var d=function(){return j};return({init:G,destroy:J,bindEvent:function(M,N){$(e).bind(M,N)},unbindEvent:function(M,N){$(e).unbind(M,N)},getContainer:function(){return z},settings:K,getHeight:v,reset:q,reinit:b,next:D,prev:s,jumpTo:H,getCurrentItems:x,getAllItems:w,getCurrentColumn:a,getItemWidth:d})};FKART.ui.LazyCarousel=function(c){var g=new FKART.ui.Carousel(c),b;var f=g.init;var h=function(){f();b=g.getContainer();e($(".ccarousel",b).children("li.ccarousel-item").slice(0,g.settings.columns));g.bindEvent("nextSlide",function(j,i){e(i)});g.bindEvent("lazyPrevSlide",function(i,j){e(j)})};var a=function(l){if(typeof l==="number"&&l>=0&&l<g.getAllItems().length){g.jumpTo(l);var k=$(g.getAllItems()[l]);k=k.find("img");for(var j=0;j<k.length;j++){if(k[j].hasAttribute("data-carousel-src")){k[j].setAttribute("src",k[j].getAttribute("data-carousel-src"));k[j].removeAttribute("data-carousel-src")}}}};var e=function(i){$("img",i).each(function(){var j=$(this);j.attr("src",j.attr("data-carousel-src"));j.removeAttr("data-carousel-src")})};var d=function(){g.reset();var i=$(".ccarousel",b).children("li.ccarousel-item");e(i)};return({carousel:g,init:h,reset:d,jumpTo:a})};FKART.ui.PaginatedCarousel=function(n){var m=new FKART.ui.Carousel(n),b,f;var d=m.init;var a=[];var j=[];var g=false;var l=this;var k=function(){if(!n.formPaginationUrl){n.errorCallback()}else{d();b=m.getContainer();i($(".ccarousel",b).children("li.ccarousel-item").slice(0,m.settings.columns));m.bindEvent("nextSlide",function(p,o){if(n.pagination){c(o)}i(o)});m.bindEvent("lazyPrevSlide",function(p,q){i(q);var o=m.getCurrentColumn();if(j.indexOf(o)!==-1&&g){f.hide();g=false}})}};var c=function(o){var p=m.getCurrentColumn();if(j.indexOf(p)===-1&&a.indexOf(p)===-1){a.push(p);if(!f){f=new FKART.ui.Loader({size:"medium",renderInside:b,cssCls:"reco-loader",msg:"Loading..."})}if(!g){f.show();g=true}call_url=n.formPaginationUrl(o);$.get(call_url,function(q){j.push(p);a.pop();o.html(q);o.find(".carousel-item").css({width:m.getItemWidth()/n.rows});n.afterLoadCallback();if(a.length===0){f.hide();g=false}}).fail(function(){j.push(p);a.filter(function(q){return q!=p});if(a.length===0){f.hide();g=false}})}else{if(g){f.hide();g=false}}};var e=function(q){if(typeof q==="number"&&q>=0&&q<m.getAllItems().length){m.jumpTo(q);var p=$(m.getAllItems()[q]);p=p.find("img");for(var o=0;o<p.length;o++){if(p[o].hasAttribute("data-carousel-src")){p[o].setAttribute("src",p[o].getAttribute("data-carousel-src"));p[o].removeAttribute("data-carousel-src")}}}};var i=function(o){$("img",o).each(function(){var p=$(this);p.attr("src",p.attr("data-carousel-src"));p.removeAttr("data-carousel-src")})};var h=function(){m.reset();var o=$(".ccarousel",b).children("li.ccarousel-item");i(o)};return({carousel:m,init:k,reset:h,jumpTo:e})};FKART.reco=FKART.reco||{};FKART.reco.loadFooterReco=function(c){var d={title:"session",moduleContainer:c.moduleContainer||"session-reco-module",moduleUrl:"/lc/ajaxForSessionBasedReco",modulePaginationUrl:"/lc/ajaxForSessionReco",pageSize:5};isPaginated=c.isPaginated||false;var b=$("#"+d.moduleContainer),a=d.moduleUrl+"?loadDeferred=true";if(d.pageSize&&isPaginated&&d.modulePaginationUrl){a=d.modulePaginationUrl+"?loadDeferred=true&pageSize="+d.pageSize+"&recoPageSize=5"}$.get(a,function(e){b.after(e);b.remove();init_controllers()})};function updateUrls(b){var a=$(".urlTracker",b);if(a.length!=0){a.each(function(){var i=$(this),e=i.data("category"),g=i.data("vertical"),j=i.data("pos"),k=i.data("icmpattr"),l=i.data("url"),f=i.data("ppid"),h=i.data("pid"),c=l,d="";if(FKART.analytics&&"category" in FKART.analytics){d=formatCategoryString(FKART.analytics.category)}else{d=formatCategoryString(e)}if(h!=f){c=c+"&icmpid="+constructIcmpidParams(k,d,formatCategoryString(g),j)}if(f){c=c+"&ppid="+f}i.attr("href",c)})}}function formatCategoryString(a){if(!a||a.length==0){return"na"}return a.trim().toLowerCase().replace(/_/g,"")}function constructIcmpidParams(c,g,d,a){var f=$("#reco-module-wrapper");if(c.indexOf("reco")===-1&&f.data("pageid")){c="reco_"+f.data("pageid")+"_"+c}var b="",e=Array.prototype.slice.call(arguments);e.forEach(function(i,j,h){b=b+i;if(j!=(h.length-1)){b=b+"_"}});return b}function loadImgFallbacks(a){var b=$("img",a);b.each(function(){var c=$(this);c.error(function(){var d=c.data("error-url");if(d&&d.length!=0){c.attr("src",d)}})})}register_controller("VerticalReco",function(a){updateUrls(a);loadImgFallbacks(a);$(a).each(function(){var d=$(this);var c=d.data();var f={content:$(".ccarousel",d),afterLoadCallback:function(){updateUrls(a)},formPaginationUrl:function(h){var i=$(h).data(c.paginationUnit);if(FKART.product&&FKART.product.pid){var g="/lc"+c.paginationUrl+"?loadDeferred=true&pid="+FKART.product.pid+"&pids="+i}else{var g="/lc"+c.paginationUrl+"?loadDeferred=true&pids="+i}return g},errorCallback:function(){$(".fk-ui-ccarousel-title",d).hide();$(".fk-ui-ccarousel-border",d).hide()}};$.extend(f,c);if(c.pagination){var b=new FKART.ui.PaginatedCarousel(f)}else{var b=new FKART.ui.LazyCarousel(f)}b.init();d.removeClass("require-product-carousel");d.data("instance",b);EventBus.subscribe("reco.cartCarouselReset",function(){b.reset()});if(f.animatedload){var e=$(".pp-top-cross-recos-container .fk-ui-ccarousel-supercontainer").data("instance").carousel.getHeight();$(".pp-top-cross-recos-container").addClass("animate reco-carousel-border-top reco-carousel-border-bottom bmargin10")}})});